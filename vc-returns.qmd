---
title: "Analysis of expected VC portfolio returns"
format: html
params:
  sims: 10000
  n_deals: 20
  seed: 42
---

```{r}
#| label: setup
#| message: false
library(tidyverse)
```

This notebook runs a simulation for a portfolio of `r params$n_deals` VC assets with a characteristic distribution profile (see more on this below). It calculates the distribution of portfolio multiple on invested capital (MOIC), gross and net of fees. For simplicity, all investments are assumed to be of equal size and fee structure reflects Toloka's fees and carry (for typical \$5k and \$10k deal sizes) and payment processing fees. The effect of taxes is not considered here.

```{r}
#| label: assumptions

# Deal-level gross MOIC distribution bins: (lo, hi, probability)
bins <- list(
  A = tibble(
    lo  = c(0.0, 0.1, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0),
    hi  = c(0.0, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0, 50.0),
    prob = c(0.32, 0.19, 0.18, 0.14, 0.04, 0.03, 0.06, 0.03, 0.01)
  ),
  B = tibble(
    lo  = c(0.0, 0.1, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0),
    hi  = c(0.0, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0, 50.0),
    prob = c(0.25, 0.17, 0.18, 0.19, 0.07, 0.05, 0.06, 0.02, 0.01)
  ),
  C = tibble(
    lo  = c(0.0, 0.1, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0),
    hi  = c(0.0, 0.5, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0, 50.0),
    prob = c(0.18, 0.15, 0.17, 0.26, 0.09, 0.06, 0.06, 0.02, 0.01)
  )
)

# Fee structures
fees <- list(
  `5k` = list(label = "Net 5k", entry = 0.085, processing = 0.01, carry = 0.20, hurdle = 0.10),
  `10k` = list(label = "Net 10k", entry = 0.075, processing = 0.01, carry = 0.20, hurdle = 0.10)
)

# Portfolio allocation between series A, B, and C deals
pf_alloc <- c(A = 0.2, B = 0.4, C = 0.4)
```

```{r}
#| label: helper-functions

# Convert allocation proportions to integer deal counts summing to n_deals
mix_to_counts <- function(alloc, n_deals) {
  raw <- alloc * n_deals
  floored <- floor(raw)
  remainder <- n_deals - sum(floored)
  fracs <- raw - floored
  # distribute remainder to largest fractional parts
  bump <- rank(-fracs, ties.method = "first") <= remainder
  floored + bump
}

# Prepare cumulative distribution from bins
prepare_bins <- function(b) {
  b |>
    mutate(
      prob = prob / sum(prob),
      cdf = cumsum(prob)
    )
}

# Sample a single deal MOIC from a prepared bin distribution
sample_deal <- function(prepared, rng_vals, idx) {
  u <- rng_vals[idx]
  bin_idx <- min(which(prepared$cdf >= u))
  lo <- prepared$lo[bin_idx]
  hi <- prepared$hi[bin_idx]
  if (lo == 0 && hi == 0) return(0)
  if (lo == hi) return(lo)
  # log-uniform between lo and hi
  exp(log(lo) + runif(1) * (log(hi) - log(lo)))
}

# Apply fees with hurdle to calculate net portfolio MOIC
apply_fees_with_hurdle <- function(deal_moics, fee) {
  paid_in <- 1 * (1 + fee$entry + fee$processing)
  net_values <- vapply(deal_moics, function(gross) {
    profit <- max(gross - 1, 0)
    carry_base <- max(profit - fee$hurdle, 0)
    carry_fee <- fee$carry * carry_base
    gross - carry_fee
  }, numeric(1))
  sum(net_values) / (paid_in * length(deal_moics))
}

# Summarize a distribution of portfolio MOICs
summarize_moic <- function(x, label) {
  qs <- quantile(x, probs = c(0.05, 0.25, 0.5, 0.75, 0.95))
  tibble(
    Scenario  = label,
    Mean      = mean(x),
    Median    = qs[3],
    `5th %`   = qs[1],
    `25th %`  = qs[2],
    `75th %`  = qs[4],
    `95th %`  = qs[5],
    `P(<1.0×)` = mean(x < 1.0),
    `P(>1.5×)` = mean(x > 1.5),
    `P(>2.0×)` = mean(x > 2.0)
  )
}
```

```{r}
#| label: simulation

set.seed(params$seed)

n_deals <- params$n_deals
sims <- params$sims

# Compute deal counts per stage
pf_mix <- mix_to_counts(pf_alloc, n_deals)

# Prepare CDFs
pbins <- map(bins, prepare_bins)

# Simulate deal-level MOICs for all portfolios
# For each sim, draw n_deals deals according to pf_mix allocation
assets_by_sim <- map(seq_len(sims), function(s) {
  deals <- numeric(n_deals)
  idx <- 1
  for (stage in names(pf_mix)) {
    count <- pf_mix[stage]
    prep <- pbins[[stage]]
    for (k in seq_len(count)) {
      u <- runif(1)
      bin_idx <- min(which(prep$cdf >= u))
      lo <- prep$lo[bin_idx]
      hi <- prep$hi[bin_idx]
      if (lo == 0 && hi == 0) {
        deals[idx] <- 0
      } else if (lo == hi) {
        deals[idx] <- lo
      } else {
        deals[idx] <- exp(log(lo) + runif(1) * (log(hi) - log(lo)))
      }
      idx <- idx + 1
    }
  }
  deals
})

# Gross portfolio MOIC per simulation
gross_moic <- map_dbl(assets_by_sim, mean)

# Net portfolio MOIC per simulation for each fee structure
net_moic <- map(fees, function(fee) {
  map_dbl(assets_by_sim, \(deals) apply_fees_with_hurdle(deals, fee))
})
```

```{r}
#| label: summary-table

bind_rows(
  summarize_moic(gross_moic, "Gross MOIC"),
  summarize_moic(net_moic$`5k`, fees$`5k`$label),
  summarize_moic(net_moic$`10k`, fees$`10k`$label)
) |>
  knitr::kable(digits = 3)
```

```{r}
#| label: fig-portfolio-moic
#| fig-cap: "Portfolio MOIC distribution"
#| fig-height: 6

moic_dist <- bind_rows(

  tibble(x = gross_moic, series = "Gross MOIC"),
  tibble(x = net_moic$`5k`, series = fees$`5k`$label),
  tibble(x = net_moic$`10k`, series = fees$`10k`$label)
) |>
  mutate(series = factor(series, levels = c("Gross MOIC", fees$`5k`$label, fees$`10k`$label)))

ggplot(moic_dist, aes(x = x, fill = series)) +
  geom_histogram(aes(y = after_stat(count / sum(count))),
                 bins = 60, show.legend = FALSE) +
  facet_wrap(~series, ncol = 1, scales = "free_y") +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = NULL) +
  theme_minimal()
```

## Net returns by series

Compare portfolio returns when investing exclusively in Series A, B, or C deals.

```{r}
#| label: series-simulation

# Simulate pure single-stage portfolios
series_moic <- imap(pbins, function(prep, stage) {
  gross <- numeric(sims)
  net_5k <- numeric(sims)
  net_10k <- numeric(sims)

  for (s in seq_len(sims)) {
    deals <- numeric(n_deals)
    for (k in seq_len(n_deals)) {
      u <- runif(1)
      bin_idx <- min(which(prep$cdf >= u))
      lo <- prep$lo[bin_idx]
      hi <- prep$hi[bin_idx]
      if (lo == 0 && hi == 0) {
        deals[k] <- 0
      } else if (lo == hi) {
        deals[k] <- lo
      } else {
        deals[k] <- exp(log(lo) + runif(1) * (log(hi) - log(lo)))
      }
    }
    gross[s] <- mean(deals)
    net_5k[s] <- apply_fees_with_hurdle(deals, fees$`5k`)
    net_10k[s] <- apply_fees_with_hurdle(deals, fees$`10k`)
  }
  list(gross = gross, net_5k = net_5k, net_10k = net_10k)
})
```

```{r}
#| label: series-summary-table

imap(series_moic, \(m, stage) {
  bind_rows(
    summarize_moic(m$gross,  paste("Series", stage, "— Gross")),
    summarize_moic(m$net_5k, paste("Series", stage, "— Net 5k")),
    summarize_moic(m$net_10k, paste("Series", stage, "— Net 10k"))
  )
}) |>
  list_rbind() |>
  knitr::kable(digits = 3)
```

```{r}
#| label: fig-series-net-comparison
#| fig-cap: "Net MOIC distribution by series (5k deal size)"
#| fig-height: 6

series_dist <- imap(series_moic, \(m, stage) {
  tibble(x = m$net_5k, series = paste("Series", stage))
}) |>
  list_rbind() |>
  mutate(series = factor(series, levels = c("Series A", "Series B", "Series C")))

ggplot(series_dist, aes(x = x, fill = series)) +
  geom_histogram(aes(y = after_stat(count / sum(count))),
                 bins = 60, show.legend = FALSE) +
  facet_wrap(~series, ncol = 1, scales = "free_y") +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = NULL) +
  theme_minimal()
```

```{r}
#| label: fig-series-net-overlay
#| fig-cap: "Net MOIC density by series (5k deal size)"

ggplot(series_dist, aes(x = x, colour = series, fill = series)) +
  geom_density(alpha = 0.15) +
  geom_vline(xintercept = 1, linetype = "dashed", alpha = 0.5) +
  labs(x = "Multiple (×)", y = "Density", colour = NULL, fill = NULL) +
  theme_minimal()
```

## YC Demo Day seed-stage analysis

This section models returns for seed-stage investments in YC Demo Day funds, based on data from [AngelList Demo Day Funds](https://www.angellist.com/demo-day-funds), [Jared Heyman's analysis](https://jaredheyman.medium.com/on-the-176-annual-return-of-a-yc-startup-index-cf4ba8ebef19), and [Lenny's Newsletter deep dive on YC](https://www.lennysnewsletter.com/p/pulling-back-the-curtain-on-the-magic).

Key data points informing the seed distribution:

- AngelList DDF batch MOICs (net, 2016–2023) range from 0.53× to 11.63×, with median ~1.8×
- ~5–6% of YC startups become unicorns (vs 2.5% for other VC-backed seed startups)
- ~13% of YC companies have gone out of business (vs ~70% failure rate in broader seed VC)
- Top companies produce 100×–1000×+ returns for seed investors (extreme power law)
- ~45% of YC companies raise a Series A (vs 33% average)

The derived seed-stage deal distribution reflects YC's significantly better survival and hit rates compared to the general VC distributions above.

```{r}
#| label: yc-seed-assumptions

# YC seed-stage deal-level gross MOIC distribution
# Derived from DDF batch data + industry analysis:
# - Much lower total loss rate (~13% dead vs ~25-32% for Series A-C)
# - Higher probability of moderate outcomes (YC companies are more durable)
# - Fat tail: ~5-6% unicorn rate at seed → very high multiples possible
# - Extreme tail: a few 500x-1000x+ outcomes (Airbnb, Stripe, etc.)
bins_seed <- tibble(
  lo   = c(0.0,  0.1, 0.5, 1.0,  2.0,  3.0,  5.0,  10.0, 20.0,  50.0, 100.0),
  hi   = c(0.0,  0.5, 1.0, 2.0,  3.0,  5.0,  10.0, 20.0, 50.0, 100.0, 500.0),
  prob = c(0.13, 0.12, 0.15, 0.25, 0.12, 0.08, 0.06, 0.04, 0.03, 0.015, 0.005)
)

# Toloka seed fee structure
fees_seed <- list(
  label = "YC Seed Net",
  entry = 0.085,
  processing = 0.01,
  carry = 0.20,
  hurdle = 0.00
)

pbins_seed <- bins_seed |>
  mutate(
    prob = prob / sum(prob),
    cdf = cumsum(prob)
  )
```

```{r}
#| label: yc-seed-deal-distribution
#| fig-cap: "YC seed deal-level MOIC distribution (assumed)"
#| fig-height: 3

seed_dist_plot <- bins_seed |>
  mutate(
    x1_plot = if_else(lo == 0 & hi == 0, 0, lo),
    x2_plot = if_else(lo == 0 & hi == 0, 0.08, hi)
  )

ggplot(seed_dist_plot, aes(xmin = x1_plot, xmax = x2_plot, ymin = 0, ymax = prob)) +
  geom_rect(fill = "darkorange", alpha = 0.8) +
  scale_x_continuous(
    trans = "pseudo_log",
    breaks = c(0, 0.1, 0.5, 1, 2, 3, 5, 10, 20, 50, 100, 500)
  ) +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = "Probability", title = "YC Seed — assumed deal MOIC distribution") +
  theme_minimal()
```

```{r}
#| label: yc-seed-simulation

# Apply fees with zero hurdle for seed
apply_fees_seed <- function(deal_moics, fee) {
  paid_in <- 1 * (1 + fee$entry + fee$processing)
  net_values <- vapply(deal_moics, function(gross) {
    profit <- max(gross - 1, 0)
    carry_fee <- fee$carry * profit  # no hurdle
    gross - carry_fee
  }, numeric(1))
  sum(net_values) / (paid_in * length(deal_moics))
}

# Simulate YC seed portfolios
seed_gross <- numeric(sims)
seed_net <- numeric(sims)

for (s in seq_len(sims)) {
  deals <- numeric(n_deals)
  for (k in seq_len(n_deals)) {
    u <- runif(1)
    bin_idx <- min(which(pbins_seed$cdf >= u))
    lo <- pbins_seed$lo[bin_idx]
    hi <- pbins_seed$hi[bin_idx]
    if (lo == 0 && hi == 0) {
      deals[k] <- 0
    } else if (lo == hi) {
      deals[k] <- lo
    } else {
      deals[k] <- exp(log(lo) + runif(1) * (log(hi) - log(lo)))
    }
  }
  seed_gross[s] <- mean(deals)
  seed_net[s] <- apply_fees_seed(deals, fees_seed)
}
```

```{r}
#| label: yc-seed-summary-table

bind_rows(
  summarize_moic(seed_gross, "YC Seed — Gross"),
  summarize_moic(seed_net, "YC Seed — Net (8.5% fee, 20% carry, 0 hurdle)")
) |>
  knitr::kable(digits = 3)
```

```{r}
#| label: fig-yc-seed-vs-stages
#| fig-cap: "Net MOIC comparison: YC Seed vs Series A/B/C (all at 5k fee structure)"
#| fig-height: 8

all_net <- bind_rows(
  tibble(x = seed_net, series = "YC Seed"),
  imap(series_moic, \(m, stage) {
    tibble(x = m$net_5k, series = paste("Series", stage))
  }) |> list_rbind()
) |>
  mutate(series = factor(series, levels = c("YC Seed", "Series A", "Series B", "Series C")))

ggplot(all_net, aes(x = x, fill = series)) +
  geom_histogram(aes(y = after_stat(count / sum(count))),
                 bins = 60, show.legend = FALSE) +
  facet_wrap(~series, ncol = 1, scales = "free_y") +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = NULL) +
  theme_minimal()
```

```{r}
#| label: fig-yc-seed-density-overlay
#| fig-cap: "Net MOIC density: YC Seed vs Series A/B/C"

ggplot(all_net, aes(x = x, colour = series, fill = series)) +
  geom_density(alpha = 0.1) +
  geom_vline(xintercept = 1, linetype = "dashed", alpha = 0.5) +
  labs(x = "Multiple (×)", y = "Density", colour = NULL, fill = NULL) +
  theme_minimal()
```

```{r}
#| label: yc-seed-combined-summary

bind_rows(
  summarize_moic(seed_net, "YC Seed — Net"),
  imap(series_moic, \(m, stage) {
    summarize_moic(m$net_5k, paste("Series", stage, "— Net 5k"))
  }) |> list_rbind()
) |>
  knitr::kable(digits = 3)
```

#### AngelList Demo Day Fund actual batch returns

For reference, the reported net-of-fees MOICs for AngelList YC Demo Day Funds (as of Jan 2026):

```{r}
#| label: ddf-actual-returns

ddf_returns <- tibble(
  Batch = c("W16","S16","W17","S17","W18","S18","W19","S19",
            "W20","S20","W21","S21","W22","S22","W23","S23"),
  IRR = c(0.28, -0.07, 0.22, 0.17, 0.37, 0.19, 0.45, 0.13,
          0.11, 0.40, 0.07, 0.02, 0.07, 0.05, 0.07, 0.18),
  MOIC = c(8.55, 0.53, 5.42, 3.70, 9.92, 2.90, 11.63, 2.12,
           1.80, 4.93, 1.38, 1.09, 1.32, 1.18, 1.20, 1.48),
  Quartile = c("Top Decile","Bottom Decile","Top Decile","Top Decile",
               "Top Decile","Top Quartile","Top Decile","Top Quartile",
               "Top Quartile","Top Decile","Top Quartile","Median",
               "Top Quartile","Median","Median","Top Decile")
)

knitr::kable(ddf_returns, col.names = c("Batch", "IRR", "MOIC (×)", "Quartile"))
```

Note: Recent batches (2021–2023) show lower MOICs because those funds are still immature — most companies haven't had exits yet. The mature batches (2016–2020) show strong performance with median MOIC of ~3.3× and several batches above 5×.

## Assumptions

#### Asset multiple distribution

Assumed gross MOIC distribution at deal level by stage.

```{r}
#| label: fig-deal-distribution
#| fig-cap: "Deal-level MOIC distribution by stage"
#| fig-height: 6

deal_dist <- imap(bins, \(b, stage) {
  b |> mutate(series = paste("Series", stage))
}) |>
  list_rbind() |>
  # for the zero bin, widen it slightly so it's visible

  mutate(
    x1_plot = if_else(lo == 0 & hi == 0, 0, lo),
    x2_plot = if_else(lo == 0 & hi == 0, 0.08, hi)
  )

ggplot(deal_dist, aes(xmin = x1_plot, xmax = x2_plot, ymin = 0, ymax = prob, fill = series)) +
  geom_rect(show.legend = FALSE) +
  facet_wrap(~series, ncol = 1) +
  scale_x_continuous(
    trans = "pseudo_log",
    breaks = c(0, 0.1, 0.5, 1, 2, 3, 5, 10, 20, 50)
  ) +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = "Probability") +
  theme_minimal()
```

This is aligned with industry studies. E.g. [Seth Levine](https://sethlevine.com/archives/2014/08/venture-outcomes-are-even-more-skewed-than-you-think.html) reports data by [Correlation Ventures](http://www.correlationvc.com/) showing the distribution of outcomes across over 21,000 VC financings spanning 2004-2013. Based on it, 65% of financings fail to return 1x capital, 10% produce a return of 5x or more, and 4% produce a return of 10x or more.

```{r}
#| label: fig-cdf
#| fig-cap: "Deal multiple CDFs by stage"

cdf_data <- imap(pbins, \(b, stage) {
  b |> mutate(series = paste("Series", stage))
}) |>
  list_rbind()

ggplot(cdf_data, aes(x = hi, y = cdf, colour = series)) +
  geom_line(linewidth = 0.8) +
  geom_vline(xintercept = c(1, 5, 10), linetype = "dashed", alpha = 0.5) +
  scale_x_continuous(
    trans = "pseudo_log",
    breaks = c(0, 1, 2, 3, 5, 10, 20, 50)
  ) +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(x = "Multiple (×)", y = NULL, colour = NULL) +
  theme_minimal()
```

#### Portfolio composition

```{r}
#| label: fig-portfolio-mix
#| fig-cap: "Portfolio composition"
#| fig-height: 3.5

mix_df <- tibble(
  stage = paste("Series", names(pf_mix)),
  count = unname(pf_mix)
)

ggplot(mix_df, aes(x = "", y = count, fill = stage)) +
  geom_col(width = 1) +
  coord_polar(theta = "y") +
  labs(fill = NULL, x = NULL, y = NULL) +
  theme_void()
```

#### Fees

```{r}
#| label: fee-table

imap(fees, \(f, key) {
  tibble(
    Deal = key,
    Label = f$label,
    `Entry fee` = f$entry,
    `Processing fee` = f$processing,
    Carry = f$carry,
    Hurdle = f$hurdle
  )
}) |>
  list_rbind() |>
  knitr::kable()
```

### Check simulated distribution at deal level

```{r}
#| label: fig-simulated-deals
#| fig-cap: "Simulated deal-level MOIC distribution"
#| fig-height: 3

all_deals <- tibble(x = unlist(assets_by_sim))
edges <- c(0, 0.001, 0.1, 0.5, 1, 2, 3, 5, 10, 20, 50)

ggplot(all_deals, aes(x = x)) +
  geom_histogram(aes(y = after_stat(count / sum(count))),
                 breaks = edges, fill = "steelblue") +
  scale_x_continuous(
    trans = "pseudo_log",
    breaks = c(0, 0.1, 0.5, 1, 2, 3, 5, 10, 20, 50)
  ) +
  labs(x = "Multiple (×)", y = "Probability") +
  theme_minimal()
```
